# yaml-language-server: $schema=https://raw.githubusercontent.com/kyverno/chainsaw/main/.schemas/json/test-chainsaw-v1alpha1.json
apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  creationTimestamp: null
  name: 1-012-validate-custom-env
spec:
  steps:
  - name: step-01
    try:
    - apply:
        file: 01-install.yaml
    - assert:
        file: 01-assert.yaml
  - name: step-02
    try:
    - apply:
        file: 02-change-env-vars.yaml
  - name: step-03
    try:
    - script:
        content: sleep 30
    - script:
        content: "set -e\nfor wl in deployment/argocd-server deployment/argocd-repo-server
          statefulset/argocd-application-controller; do\n  val=$(kubectl get -n $NAMESPACE
          $wl -o json | jq -r '.spec.template.spec.containers[0].env[]|select(.name==\"FOO\").value')\n
          \ if test \"$val\" != \"bar\"; then\n    echo \"Environment for $wl was
          not set correctly.\"\n    exit 1\n  fi\ndone\n\n  \n"
