apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
- script: sleep 15
- script: |
    set -e
    for wl in deployment/argocd-server deployment/argocd-repo-server statefulset/argocd-application-controller; do
      wlCommand=$(kubectl get -n $NAMESPACE $wl -o jsonpath='{.spec.template.spec.containers[0].command}'| jq -r '.[]' | tr '\n' ' ' )
      level="debug"
      format="json"
      if ! echo "$wlCommand" | grep -q -- "--loglevel $level"; then
        echo "logLevel was not set correctly for $wl"
        echo "CWD: $wlCommand"
        exit 1
      fi
      if ! echo "$wlCommand" | grep -q -- "--logformat $format"; then
        echo "logFormat was not set correctly for $wl"
        echo "CWD: $wlCommand"
        exit 1
      fi
    done